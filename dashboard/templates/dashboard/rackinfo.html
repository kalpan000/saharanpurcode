{% extends 'dashboard/header_footer.html' %} {% load utils %}{% load static %} {% block title %} Rack Information {% endblock %}
{% block css %}

<link href='{% static "dashboard/css/custom.css" %}' rel='stylesheet' type='text/css'>
<style>
.MyClass{
    display:none;
}
.checkbox{
width: 21px;
display: flex;
background: #fff;
align-items: center;
border-radius: 5px;
box-shadow: 5px 5px 30px rgba(0,0,0,.2);
justify-content: space-between;
left: 21px;
margin-top: 0px;
margin-bottom: 0px;
}
.checkbox input{
  outline: none;
  height: 20px;
  width: 39px;
  border-radius: 50px;
  -webkit-appearance: none;
  position: relative;
  background: #e6e6e6;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
  transition: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
.checkbox input:checked{
  background: #664AFF;
}
.checkbox input:before{
  position: absolute;
  content: "";
  left: 0;
  height: 100%;
  width: 20px;
  background: linear-gradient(#fff,#f2f2f2,#e6e6e6,#d9d9d9);
  box-shadow: 0 2px 5px rgba(0,0,0,.2);
  border-radius: 50px;
  transform: scale(0.85);
  transition: left 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}
input:checked:before{
  left: 19px;
}
    .inner-block {
        background-image: url("{% static 'dashboard/images/data_center.png' %}");
   background-repeat: no-repeat;
   background-size: 100% 100%;
   background-attachment: fixed;
}
.switch {
        position: relative;
        display: block;
        vertical-align: top;
        width: 35px;
        height: 20px;
        padding: 2px;
        margin: 0 10px 10px 0;
        background: linear-gradient(to bottom, #eeeeee, #FFFFFF 25px);
        background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF 25px);
        border-radius: 18px;
        box-shadow: inset 0 -1px white, inset 0 1px 1px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        box-sizing: content-box;
    }
    
    .switch-input {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
        box-sizing: content-box;
    }
    
    .switch-label {
        position: relative;
        display: block;
        height: inherit;
        font-size: 8px;
        text-transform: uppercase;
        background: #eceeef;
        border-radius: inherit;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 2px rgba(0, 0, 0, 0.15);
        box-sizing: content-box;
    }
    
    .switch-label:before,
    .switch-label:after {
        position: absolute;
        top: 50%;
        margin-top: -.5em;
        line-height: 1;
        -webkit-transition: inherit;
        -moz-transition: inherit;
        -o-transition: inherit;
        transition: inherit;
        box-sizing: content-box;
    }
    
    .switch-label:before {
        content: attr(data-off);
        right: 11px;
        color: #aaaaaa;
        text-shadow: 0 1px rgba(255, 255, 255, 0.5);
    }
    
    .switch-label:after {
        content: attr(data-on);
        left: 5px;
        color: #FFFFFF;
        text-shadow: 0 1px rgba(0, 0, 0, 0.2);
        opacity: 0;
    }
    
    .switch-input:checked~.switch-label {
        background: #16bd10;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.15), inset 0 0 3px rgba(0, 0, 0, 0.2);
    }
    
    .switch-input:checked~.switch-label:before {
        opacity: 0;
    }
    
    .switch-input:checked~.switch-label:after {
        opacity: 1;
    }
    
    .switch-handle {
        position: absolute;
        top: 7px;
        left: 7px;
        width: 10px;
        height: 10px;
        background: linear-gradient(to bottom, #FFFFFF 40%, #f0f0f0);
        background-image: -webkit-linear-gradient(top, #FFFFFF 40%, #f0f0f0);
        border-radius: 100%;
        box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
    }
    
    .switch-handle:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -6px 0 0 -6px;
        width: 12px;
        height: 12px;
        background: linear-gradient(to bottom, #eeeeee, #FFFFFF);
        background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF);
        border-radius: 6px;
        box-shadow: inset 0 1px rgba(0, 0, 0, 0.02);
    }
    
    .switch-input:checked~.switch-handle {
        left: 28px;
        box-shadow: -1px 1px 5px rgba(0, 0, 0, 0.2);
    }
    /* Transition
========================== */
    
    .switch-label,
    .switch-handle {
        transition: All 0.3s ease;
        -webkit-transition: All 0.3s ease;
        -moz-transition: All 0.3s ease;
        -o-transition: All 0.3s ease;
    }
    
    .toggle {
        width: 30px !important;
        height: 20px !important;
    }
}
.toggle-handle {
    display: none;
    position: unset !important;
}
.toggle-off {
    left: 50% !important;
}
.toggle-off.btn {
    padding-left: 0.5rem !important;
}
</style>
{% endblock css %} 
{% block title_header %}Rack Info{% endblock %}
{% block content %}

<style>
    .MRG {
        background-color: #82E0AA;
    }
    
    .MRA {
        background-color: #F5B041;
    }
    
    .MRR {
        background-color: #EC7063;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
    }
    
    table,
    th,
    td {
        border: 1px solid black;
    }
    
    th,
    td {
        padding: 10px;
    }
    
    * {
        box-sizing: border-box;
    }
    
    body {
        font-family: Arial, Helvetica, sans-serif;
    }
    /* Float four columns side by side */
    
    .column {
        float: left;
        width: 25%;
        padding: 0 10px;
    }
    /* Remove extra left and right margins, due to padding */
    
    .row {
        margin: 0 -5px;
    }
    /* Clear floats after the columns */
    
    .row:after {
        content: "";
        display: table;
        clear: both;
    }
    /* Responsive columns */
    
    @media screen and (max-width: 600px) {
        .column {
            width: 50%;
            display: block;
            margin-bottom: 20px;
        }
    }
    /* Style the counter cards */
    
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        padding: 16px;
        width: 85%;
        text-align: center;
        background-color: #f1f1f1;
    }
    th{
        text-align:center;
    }
    [data-title]:hover:after {
    opacity: 1;
    transition: all 0.1s ease 0.5s;
    visibility: visible;
}
[data-title]:after {
    content: attr(data-title);
    background-color: #00FF00;
    color: #111;
    font-size: 150%;
    position: absolute;
    padding: 1px 5px 2px 5px;
    bottom: -1.6em;
    left: 100%;
    white-space: nowrap;
    box-shadow: 1px 1px 3px #222222;
    opacity: 0;
    border: 1px solid #111111;
    z-index: 99999;
    visibility: hidden;
}
[data-title] {
    position: relative;
}
</style>

<div class="container-fluid">
    <div class="row">
        <h2 style="">{{ datacenterracks }} Rack Information</h2>


        <div class="column">
            <div class="card" style="background-color: #729391 ;color: white;padding:10px;border-radius:10px;">
                <p style="font-weight: bolder;">Rack Load</p>
                <h4 style="margin:10px;">Print Load : {{rackload}}</h4>
            </div>


        </div>

        <div class="column">
            <div class="card" style="background-color: #9c75b9;color: white;padding:10px;border-radius:10px;">

                <p style="font-weight: bolder;">Total Devices</p>
                <h4 style="margin: 10px;"> Occupied : {{count_device}}
                 {% comment %} <br> Free Slots :  {{datacenterracks.Rack_Type_Information|subtract:occupied_slots}}  {% endcomment %}
                 </h4>

            </div>
        </div>
        <div class="column">
            <div class="card" style="background-color: #0c2e96;color: white;padding:10px;border-radius:10px;">
                <p style="font-weight: bolder;">PDU Port</p>
                <h4 style="margin:10px;">Total : {{pdu_devices}}</h4>
            </div>
        </div>
        <div class="column">
            <div class="card" style="background-color: red;color: white;padding:10px;border-radius:10px;">
                <p style="font-weight: bolder;">Notification</p>
                <h4 style="margin:10px;">0</h4>
            </div>
        </div>
    </div>

    <div class="row" style="margin-top: 10px;">
        <div class="col-md-4">
            <div class="demo-grid">
                <table style="line-height:1;table-layout:fixed;width:100%;" id="tables">
                    <tr style="width:50%">
                        <th style="width:5%;background-color:darkgreen"></th>
                        <th style="width:8%;">PDU<br>L</th>
                        <th style="font-weight:bolder; width:30%;line-height: 20px;background:{{datacenterracks.RowColor}}"><span>Rack</span><br><span style="font-size:10px;">(Front View)</span></th>
                        <th style="width:8%;">PDU<br>R</th>
                        <th style="width:5%;background-color:darkgreen"></th>
                    </tr>
                </table>
            </div>
        </div>
<div class="col-md-4">
        <form class="form-inline" action="{% url 'rack_page' datacenterracks.id %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="formThree">
        Select Patch Panel:
        <select class="form-control" name="patch" id="patch">

        {% for patch in device %}
        {% if patch.type_of_device == "Patch Panel" %}
        <option value="{{patch.id}}">{{patch}}</option>
        {% endif %}
        {% endfor %}

        {% comment %} {% for patch in patchpanel %}
        <option value="{{patch.id}}">{{patch.name}}</option>
        {% endfor %} {% endcomment %}
        </select>
        <input class="btn btn-primary" type="submit" value="Show">
        </form>

             <div class="panel-group" id="accordion">
                <div class="panel panel-default" style="border-color: #337ab7">
                    <div class="panel-heading" style="background-color: #337ab7;color: white;">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse4">Patch Panel</a>
                        </h4>
                    </div>
                    <div id="collapse4" class="panel-collapse collapse">
                        <div class="panel-body">
                        <h3 style="text-align: center;"> (Inwards)</h3>
                        <div class="table-responsive">
            <table class="table" style="">
                <tr>
                    <td id="inwards_patch_panel_1">1</td>
                    <td id="inwards_patch_panel_5">5</td>
                    <td id="inwards_patch_panel_9">9</td>
                    <td id="inwards_patch_panel_13">13</td>
                    <td id="inwards_patch_panel_17">17</td>
                    <td id="inwards_patch_panel_21">21</td>
                    <td id="inwards_patch_panel_25">25</td>
                    <td id="inwards_patch_panel_29">29</td>
                    <td id="inwards_patch_panel_33">33</td>
                    <td id="inwards_patch_panel_37">37</td>
                    <td id="inwards_patch_panel_41">41</td>
                    <td id="inwards_patch_panel_45">45</td>
                </tr>
                <tr>
                    <td id="inwards_patch_panel_2">2</td>
                    <td id="inwards_patch_panel_6">6</td>
                    <td id="inwards_patch_panel_10">10</td>
                    <td id="inwards_patch_panel_14">14</td>
                    <td id="inwards_patch_panel_18">18</td>
                    <td id="inwards_patch_panel_22">22</td>
                    <td id="inwards_patch_panel_26">26</td>
                    <td id="inwards_patch_panel_30">30</td>
                    <td id="inwards_patch_panel_34">34</td>
                    <td id="inwards_patch_panel_38">38</td>
                    <td id="inwards_patch_panel_42">42</td>
                    <td id="inwards_patch_panel_46">46</td>
                </tr>
                <tr>
                    <td id="inwards_patch_panel_3">3</td>
                    <td id="inwards_patch_panel_7">7</td>
                    <td id="inwards_patch_panel_11">11</td>
                    <td id="inwards_patch_panel_15">15</td>
                    <td id="inwards_patch_panel_19">19</td>
                    <td id="inwards_patch_panel_23">23</td>
                    <td id="inwards_patch_panel_27">27</td>
                    <td id="inwards_patch_panel_31">31</td>
                    <td id="inwards_patch_panel_35">35</td>
                    <td id="inwards_patch_panel_39">39</td>
                    <td id="inwards_patch_panel_43">43</td>
                    <td id="inwards_patch_panel_47">47</td>
                </tr>
                <tr>
                    <td id="inwards_patch_panel_4">4</td>
                    <td id="inwards_patch_panel_8">8</td>
                    <td id="inwards_patch_panel_12">12</td>
                    <td id="inwards_patch_panel_16">16</td>
                    <td id="inwards_patch_panel_20">20</td>
                    <td id="inwards_patch_panel_24">24</td>
                    <td id="inwards_patch_panel_28">28</td>
                    <td id="inwards_patch_panel_32">32</td>
                    <td id="inwards_patch_panel_36">36</td>
                    <td id="inwards_patch_panel_40">40</td>
                    <td id="inwards_patch_panel_44">44</td>
                    <td id="inwards_patch_panel_48">48</td>
                </tr>
            </table>
            </div>
            <br><br>



            <h3 style="text-align: center;"> (Outwards)</h3>
            <div class="table-responsive">
            <table class="table" style="">
                <tr>
                    <td id="outwards_patch_panel_1">1</td>
                    <td id="outwards_patch_panel_5">5</td>
                    <td id="outwards_patch_panel_9">9</td>
                    <td id="outwards_patch_panel_13">13</td>
                    <td id="outwards_patch_panel_17">17</td>
                    <td id="outwards_patch_panel_21">21</td>
                    <td id="outwards_patch_panel_25">25</td>
                    <td id="outwards_patch_panel_29">29</td>
                    <td id="outwards_patch_panel_33">33</td>
                    <td id="outwards_patch_panel_37">37</td>
                    <td id="outwards_patch_panel_41">41</td>
                    <td id="outwards_patch_panel_45">45</td>
                </tr>
                <tr>
                    <td id="outwards_patch_panel_2">2</td>
                    <td id="outwards_patch_panel_6">6</td>
                    <td id="outwards_patch_panel_10">10</td>
                    <td id="outwards_patch_panel_14">14</td>
                    <td id="outwards_patch_panel_18">18</td>
                    <td id="outwards_patch_panel_22">22</td>
                    <td id="outwards_patch_panel_26">26</td>
                    <td id="outwards_patch_panel_30">30</td>
                    <td id="outwards_patch_panel_34">34</td>
                    <td id="outwards_patch_panel_38">38</td>
                    <td id="outwards_patch_panel_42">42</td>
                    <td id="outwards_patch_panel_46">46</td>
                </tr>
                <tr>
                    <td id="outwards_patch_panel_3">3</td>
                    <td id="outwards_patch_panel_7">7</td>
                    <td id="outwards_patch_panel_11">11</td>
                    <td id="outwards_patch_panel_15">15</td>
                    <td id="outwards_patch_panel_19">19</td>
                    <td id="outwards_patch_panel_23">23</td>
                    <td id="outwards_patch_panel_27">27</td>
                    <td id="outwards_patch_panel_31">31</td>
                    <td id="outwards_patch_panel_35">35</td>
                    <td id="outwards_patch_panel_39">39</td>
                    <td id="outwards_patch_panel_43">43</td>
                    <td id="outwards_patch_panel_47">47</td>
                </tr>
                <tr>
                    <td id="outwards_patch_panel_4">4</td>
                    <td id="outwards_patch_panel_8">8</td>
                    <td id="outwards_patch_panel_12">12</td>
                    <td id="outwards_patch_panel_16">16</td>
                    <td id="outwards_patch_panel_20">20</td>
                    <td id="outwards_patch_panel_24">24</td>
                    <td id="outwards_patch_panel_28">28</td>
                    <td id="outwards_patch_panel_32">32</td>
                    <td id="outwards_patch_panel_36">36</td>
                    <td id="outwards_patch_panel_40">40</td>
                    <td id="outwards_patch_panel_44">44</td>
                    <td id="outwards_patch_panel_48">48</td>
                </tr>
            </table>
            </div>
            </div>
            </div>
            </div>
            </div>
            <hr>
             {% comment %} <br>
<h2>Add Patch Panel</h2>
        <form action="{% url 'rack_page' datacenterracks.id %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="formOne">
            <label for="patchname">Name :</label>
            <input type="text" name="patchname" required />            
          
          <br>
          <br>
          
            <label for="outin">Out_In :</label><br>
            <input type="checkbox" name="inwards" value="True"> Inwards 
            <input type="checkbox" name="outwards" value="True"> Outwards
              <br>  
            <br>

                    
            <input type="submit" value="save">
            
          </form>  {% endcomment %}


          
          <!--  -->
            <div class="panel-group" id="accordion">
                <div class="panel panel-default" style="border-color: #337ab7">
                    <div class="panel-heading" style="background-color: #337ab7;color: white;">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">Patch Port Form</a>
                        </h4>
                    </div>
                    <div id="collapse1" class="panel-collapse collapse">
                        <div class="panel-body">
          <form action="{% url 'rack_page' datacenterracks.id %}" class="form-horizontal" method="POST">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="formTwo">
<div class="form-group">          
      
          <label class="control-label col-sm-4" for="inOut">Patch Panel Type :</label>
          <div class="col-sm-8">
            <select class="form-control" name="inOut" id="patchtype" required>
            <option value="inwards">Inwards</option>
            <option value="outwards">Outwards</option>
            </select>
              </div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Patch Panel :</label>
            <div class="col-sm-8">
            <select class="form-control" id="sel-patch-device" name="patch" required>
        {% comment %} {% for patch in patchpanel %}
        <option value="{{patch.id}}">{{patch.name}}</option>
        {% endfor %} {% endcomment %}
        <option selected disabled>--Select Patch Panel--</option>
        {% for patch in device %}
        {% if patch.type_of_device == "Patch Panel" %}
        <option value="{{patch.id}}">{{patch}}</option>
        {% endif %}
        {% endfor %}
        </select>

            </div>
    </div>
    <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Patch Port :</label>
            <div class="col-sm-8">
            <select class="form-control" name="port" id="patch-port" required>
            </select>
              </div>
    </div>
            
                    <div class="form-group">  
                    <label class="control-label col-sm-4" id="changed">Patch Information</label>
                    <div class="col-sm-8">
                    
                        <select class="form-control" name="information">
                        <option value="crosspatch">Cross Patch</option>
                        <option value="uplink">Uplinks</option>
                        <option value="switch">Switch</option>
                        <option value="router">Router</option>
                        <option value="isp">ISP</option>
                        <option value="firewall">Firewall</option>
                        </select></div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Device :</label>
            <div class="col-sm-8">
            <select class="form-control" name="device" id="patch-device" required>
            <option selected disabled>--Select Device--</option>
              {% for data in device %}
              {% if data.type_of_device != "PDU" %}
              <option value="{{data.id}}">{{data}} ({{data.Unit_Location}})</option>
              {% endif %}
              {% endfor %}
            </select>
            
          
          </div>
    </div>
          
            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Device Port :</label>
            <div class="col-sm-8">
            <select class="form-control" name="device_port" id="patch-device-port" required>
            </select>
              </div>
    </div> 
          
            

                    
            <input type="submit" class="btn btn-primary" value="save">
            
          </form>
</div>
                        </div>
                    </div>
                </div>
          <div style="display:block;">
          <hr>
          <!--  -->
            <div class="panel-group" id="accordion">
                <div class="panel panel-default" style="border-color: #337ab7">
                    <div class="panel-heading" style="background-color: #337ab7;color: white;">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">PDU Port Form</a>
                        </h4>
                    </div>
                    <div id="collapse2" class="panel-collapse collapse">
                        <div class="panel-body">
          <form action="{% url 'rack_page' datacenterracks.id %}" class="form-horizontal" method="POST" id="pduport_frm">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="formFour">

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">PDU :</label>
            <div class="col-sm-8">
            <select class="form-control" name="pdu" id="pdusel" required>
            <option selected disabled>--PDU--</option>
            {% for pdu in device %}
            {% if pdu.type_of_device == "PDU" or pdu.type_of_device == "UPS" %}
            <option value="{{pdu.id}}">{{pdu}}</option>
            {% endif %}
            {% endfor %}
            </select>
            </div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Type :</label>
            <div class="col-sm-8">
            <select class="form-control" name="power_type" id="power_type" required>
              <option></option>
              {% comment %} <option value="lpdu">LPDU</option>
              <option value="rpdu">RPDU</option> {% endcomment %}
            </select>
            </div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Port :</label>
            <div class="col-sm-8">
            <select class="form-control" name="port" id="power_div" required>
            <option></option>
            </select>
              </div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Device :</label>
            <div class="col-sm-8">
            <select class="form-control" name="device" id="pdudevice" required>
            <option selected disabled>--Select Device--</option>
              {% for data in device %}
              {% if data.type_of_device != "PDU" %}
              <option value="{{data.id}}">{{data}} ({{data.Unit_Location}})</option>
              {% endif %}
              {% endfor %}
            </select>  
            </div>
    </div>

            <div class="form-group">  
            <label class="control-label col-sm-4" for="device">Device Port :</label>
            <div class="col-sm-8">
            <select class="form-control" name="deviceport" id="deviceport" required>
            <option></option>
            </select>
            </div>
    </div>

            
                    
            <input type="submit" id="pduport_frm_btn" class="btn btn-primary" value="save">
            
          </form>
          </div>
                    </div>
                </div>
            </div>
          </div>
          

        </div>

        <div class="col-md-4">

            <div class="demo-grid">

                <table style="line-height:1;table-layout:fixed;width:100%;" id="tables1">
                    <tr style="width:50%">
                        <th style="width:5%;background-color:darkgreen"></th>
                        <th style="width:8%;"></th>
                        <th style="font-weight:bolder; width:30%;line-height: 20px;background:{{datacenterracks.RowColor}}"><span>Rack</span><br><span style="font-size:10px;">(Rear View)</span></th>
                        <th style="width:8%;"></th>
                        <th style="width:5%;background-color:darkgreen"></th>
                    </tr>
                </table>
            </div>
        </div>
        <script>
            jQuery(document).ready(function($) {
                $(".clickable-row").click(function(e) {
                    if (e.target.id != "listItems") {
                        $(this).find("#listItems").toggle();
                    }
                });
            });

            function getDetails(id) {
                Swal.fire(id);
            }
        </script>

<script>
$("#pduport_frm").submit(function(){
    var type = $("#power_type").val();
    var port = $("#power_div").val();
    var mycheckbox;
    console.log(type, port);
    if (type == "lpdu")
        mycheckbox = "#chk-"+port+"-left";
    else
        mycheckbox = "#chk-"+port+"-right";

    if ($(mycheckbox).attr('title')){

        Swal.fire({
        title: `Device already present on port ${port} ${type}\n Want to overwrite?`,
        showCancelButton: true,
        confirmButtonText: 'Overwrite',
        }).then((result) => {
        if (result.isConfirmed) {
            console.log("OK")
        }
        })
    }
});
</script>

        <script>
            $(function() {
                var colors = [{
                    display: "light yellow",
                    value: "ffffcc"
                }, {
                    display: "light blue",
                    value: "ccffff"
                }, {
                    display: "light green",
                    value: "ccffcc"
                }, {
                    display: "gray",
                    value: "cccccc"
                }, {
                    display: "white",
                    value: "ffffff"
                }];

                var options = ['<option value="">Select color</option>'];

                for (var i = 0; i < colors.length; i++) {
                    options.push('<option value="');
                    options.push(colors[i].value);
                    options.push('">');
                    options.push(colors[i].display);
                    options.push('</option>');
                }

                $('#colorOptions').html(options.join('')).change(function() {
                    var val = $(this).val();
                    if (val) {
                        $("#mycell").css('backgroundColor', '#' + val);
                    }
                });


            });
        </script>

        <!--<div class="column">
						<div class="card">
						  <h3>Rack Load</h3>
						  <p>Print Load : 234482</p>
						  <p>Actual Load : 200083</p>
						</div>
					  </div>
					  <div class="column">
						<div class="card">
							  <p>Number of Devices : {{device_count}}</p>
							  <p>Empty slots: 20</p>
							  <p>Occupied : {{device_count}}</p>
						</div>
					  </div>-->
    </div>
    {% for patch in device %}
    {% for port in patchport %}
        {% if port.patchpanel.id == value %}
            {% if port.in_out == 'inwards' %}
        <script>
        var inwards_patch_panel_{{port.port}} = document.getElementById("inwards_patch_panel_{{port.port}}");
    if(inwards_patch_panel_{{port.port}} !== null && inwards_patch_panel_{{port.port}} !== 'undefined' ) {
            inwards_patch_panel_{{port.port}}.style.color = "white";
            inwards_patch_panel_{{port.port}}.style.background = "green";
            outwards_patch_panel_{{port.port}}.style.background = "gray";
            inwards_patch_panel_{{port.port}}.title = "Port: {{port.port}}\nDevice: {{port.device}}\nPatch Panel: {{port.patchpanel}}\nType: {{port.in_out|capfirst}}";
            //inwards_patch_panel_{{port.port}}.setAttribute("data-title", "Device: {{port.device}}\nPatch Panel: {{port.patchpanel}}\nType: {{port.in_out|capfirst}}");
    }
    </script>
    {% else %}
    <script>

    var outwards_patch_panel_{{port.port}} = document.getElementById("outwards_patch_panel_{{port.port}}");
    if(outwards_patch_panel_{{port.port}} !== null && outwards_patch_panel_{{port.port}} !== 'undefined' ) {
        outwards_patch_panel_{{port.port}}.style.color = "white";
        outwards_patch_panel_{{port.port}}.style.background = "green";
        inwards_patch_panel_{{port.port}}.style.background = "gray";
        outwards_patch_panel_{{port.port}}.title = "Port: {{port.port}}\nDevice: {{port.device}}\nPatch Panel: {{port.patchpanel}}\nType: {{port.in_out|capfirst}}";
        //outwards_patch_panel_{{port.port}}.setAttribute("data-title", "Device: {{port.device}}\nPatch Panel: {{port.patchpanel}}\nType: {{port.in_out|capfirst}}");
    }
    </script>
{% endif %}
{% endif %}

{% endfor %}
{% endfor %}
{% comment %} {% for patch in patchpanel %}
    {% for port in patchport %}
        {{patch.name}} == {{port.patchpanel}}
    {% endfor %}
{% endfor %}  {% endcomment %}
{% comment %} {% for detail in details %}
{{detail.power_on}}
{% endfor %} {% endcomment %}
</div>
{% endblock %} {% block js %}
<script src="{% static "dashboard/js/custom.js " %}"></script>
<script>

$(document).ready(function(){
    var sel = $("#device");
    $("#patchtype").change(function() {
        var device = $("#patchtype").val();
        if (device == 'inwards'){
            sel[0].options.length = 0;
            {% for data in device %}
            sel.append($("<option></option>").attr("value", "{{data.id}}").text("{{data}} ({{data.Unit_Location}})"));
            {% endfor %}
        }
        if (device == 'outwards'){
            sel[0].options.length = 0;
            {% for data in all_device %}
            sel.append($("<option></option>").attr("value", "{{data.id}}").text("{{data}} ({{data.Unit_Location}})"));
            {% endfor %}
        }
    });
    $("#pdusel").change(function() {
        var device = $("#pdusel").val();
        var token = '{{csrf_token}}';
        var type = $("#power_type");
        var port = $("#power_div");
        type[0].options.length = 0;
        port[0].options.length = 0;
        $.ajax({
            headers: { "X-CSRFToken": token },
            type: 'POST',
            url: "{% url 'getpdutype' %}",
            data: {
                'id':device,
                },
            success: function(response) {
                type.append($("<option></option>").attr("value", response["pduType"]).text(response["pduType"]));
                for (var i=1; i<=response["pduPort"]; i++){
                port.append($("<option></option>").attr("value", i).text(i));
                }
        },
            error: function(xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                Swal.fire(err.Message);
            }
        });
    });
    $("#sel-patch-device").change(function() {
        var device = $("#sel-patch-device").val();
        var token = '{{csrf_token}}';
        var port = $("#patch-port");
        port[0].options.length = 0;
        $.ajax({
            headers: { "X-CSRFToken": token },
            type: 'POST',
            url: "{% url 'getpatchport' %}",
            data: {
                'id':device,
                },
            success: function(response) {
                for (var i=1; i<=response["patchPort"]; i++){
                port.append($("<option></option>").attr("value", i).text(i));
                }
        },
            error: function(xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                Swal.fire(err.Message);
            }
        });
    });
    $("#patch-device").change(function() {
        var device = $("#patch-device").val();
        var token = '{{csrf_token}}';
        var port = $("#patch-device-port");
        port[0].options.length = 0;
        $.ajax({
            headers: { "X-CSRFToken": token },
            type: 'POST',
            url: "{% url 'getdeviceport' %}",
            data: {
                'id':device,
                },
            success: function(response) {
                for (var i=1; i<=response["devicePort"]; i++){
                port.append($("<option></option>").attr("value", i).text(i));
                }
        },
            error: function(xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                Swal.fire(err.Message);
            }
        });
    });
    $("#pdudevice").change(function() {
        var device = $("#pdudevice").val();
        var token = '{{csrf_token}}';
        var port = $("#deviceport");
        port[0].options.length = 0;
        
        $.ajax({
            headers: { "X-CSRFToken": token },
            type: 'POST',
            url: "{% url 'getpdutype' %}",
            data: {
                'id':device,
                },
            success: function(response) {
                for (var i=1; i<=response["devicePort"]; i++){
                port.append($("<option></option>").attr("value", i).text(i));
                }
        },
            error: function(xhr, status, error) {
                var err = eval("(" + xhr.responseText + ")");
                Swal.fire(err.Message);
            }
        });
    });
}); 
</script> 


{% if msg %}
<script>
Swal.fire('{{msg}}');
</script>
{% endif %}

<script>
  // array of dicts 
    var dict = [
            {% for data in tableDevice %}
        {
            'id': {{data.id}},
            'rackId': {{data.data_center_rack.id}},
            'name':'{{data.Device_Asset_Tag}}',
            'device_height':{{data.device_height}},
            'Unit_Location':{{data.Unit_Location}},
            'status_right': {{data.power_right|lower}},
            'status_left': {{data.power_left|lower}},
            'position': '{{data.pdu_position}}',
            'pdu_type': '{{data.pdu_type}}',
            'pdu_port': {{data.pdu_port}},
            'device_type': '{{data.type_of_device}}',

        },
            {% endfor %}

    ]
    var TotalLocation = {{datacenterracks.Rack_Type_Information}}
    // if deviceName = "-101" then we adding rowspans 
        // if deviceName = "-102" then we are hiding icons
        function appendRear(i, rowSpan, deviceId, deviceName = -101, unitLoc = "", rackId = "") {

            if(deviceName == -101){
                row = "<tr style='width:50%'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";
            }

            else if(deviceName == -102){
                row = "<tr style='width:50%;'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td rowspan="+ rowSpan + "> </td>\
                    <td style='font-weight:bolder;width:5%;word-wrap:break-word;' rowspan="+ rowSpan + "></td> \
                    <td rowspan="+ rowSpan + "> </td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";

            }

            else{
                row = "<tr style='width:50%'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td rowspan="+ rowSpan + "><a style='color:blue' ><i class='fa fa-edit'></i></a></td>\
                    <td id='device-"+deviceId+"-right' style='background:gray;font-weight:bolder;width:5%;word-wrap:break-word;' rowspan="+ rowSpan + "><a  style='color:white' href='/asset/datacenter/information/hall/device/" + deviceId + "/'>" + deviceName + "</a></td> \
                    <td style='color:red' rowspan="+ rowSpan + "><a style='color:red' onclick='handleDel("+ deviceId + ",{{datacenterracks.id}}," + rowSpan + "," + unitLoc + "," + rackId + ")'><i class='fa fa-trash'></i></a></td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";
            }
        
            
            $("#tables1").append(row);
        }
//if device name = -102 then its a empty row
function appendFront(i, rowSpan, deviceId, deviceName = -101) {
            var idkLeft = i <= pduSum["left"] ? i : "";
            var hideCheckBoxLeft = idkLeft == "" ? "MyClass" : "";

            var idkRight = i <= pduSum["right"] ? i : "";
            var hideCheckBoxRight = idkRight == "" ? "MyClass" : "";

            if(deviceName == -101){
                row = "<tr style='width:50%;'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td><div class='checkbox'><input class='"+ hideCheckBoxLeft + "' id='chk-" + idkLeft + "-left' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td><div class='checkbox'><input class='"+ hideCheckBoxRight + "' id='chk-" + idkRight + "-right' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";
            }
            else if (deviceName == -102){
                row = "<tr style='width:50%;'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td><div class='checkbox'><input class='"+ hideCheckBoxLeft + "' id='chk-" + idkLeft + "-left' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td style='font-weight:bolder;width:5%;word-wrap:break-word;' rowspan="+ rowSpan + "></td> \
                    <td><div class='checkbox'><input class='"+ hideCheckBoxRight + "' id='chk-" + idkRight + "-right' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";
            }
      
            else {
                row = "<tr style='width:50%;'>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;'>"+ i + "</td>\
                    <td><div class='checkbox'><input class='"+ hideCheckBoxLeft + "' id='chk-" + idkLeft + "-left' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td id='device-"+deviceId+"-left' style='background:gray;font-weight:bolder;width:5%;word-wrap:break-word;' rowspan="+ rowSpan + "><a  style='color:white' href='/asset/datacenter/information/hall/device/" + deviceId + "/'>" + deviceName + "</a></td> \
                    <td><div class='checkbox'><input class='"+ hideCheckBoxRight + "' id='chk-" + idkRight + "-right' type='checkbox' onclick='return false;' onkeydown='e = e || window.event; if(e.keyCode !== 9) return false;'/></td>\
                    <td style='width:5%; font-weight:bolder; background-color:darkslategray; color: white;' id='alpha-rear-" + i + "'>" + i + "</td>\
                </tr>";
            }
            
            $("#tables").append(row);
        }


        function totalPDU(data){
            var lsum = 0;
            var rsum = 0;

            for(i in data){
                
                if(data[i]['device_type'] == "PDU"){
                    if(data[i]["pdu_type"] == "rpdu"){
                        rsum += data[i]["pdu_port"];
                    }
                    else lsum += data[i]["pdu_port"];                    
                }
            }

            
            //console.log(data);
            //console.log({"left" : lsum , "right" : rsum});
            return {"left" : lsum , "right" : rsum};
        }

       var pduSum = totalPDU(dict);
        var dataIndex = 0;
        var skipRows = 0;

for (var i = TotalLocation; i > 0; i-- , skipRows--){

            if(dataIndex < dict.length && dict[dataIndex]["Unit_Location"] == i && skipRows <= 0){
                
                var temp = dict[dataIndex++]; 

                var id = temp['id'];
                var rackId = temp['rackId'];
                var name = temp['name'];
                var device_height = temp['device_height'];
                var Unit_Location = temp['Unit_Location'];
                var status_right = temp['status_right'];
                var status_left = temp['status_left'];
                var position = temp['position'];
                var pdu_type = temp['pdu_type'];
                var pdu_port = temp['pdu_port'];
                var device_type = temp['device_type'];
                var lowerDeviceType = device_type.toLowerCase();

                if(lowerDeviceType == "pdu"){ // to remove other type of device add || lowerDeviceType == "Patch Panel" ex.
                    // we dont like pdu and patch panel so we are ignoring it 
                    continue;
                }

                
                appendFront(i , device_height , id , name.toUpperCase());
                appendRear(i , device_height , id , name.toUpperCase() , Unit_Location , rackId);

                skipRows = device_height;            
                continue;
            }

            // when row doesnt have a device 
            appendRear(i , 1 , "empty" , (skipRows > 0 ? -101 : -102));
            appendFront(i , 1 , "empty" , (skipRows > 0 ? -101 : -102));
        }
{% for device in pduDevice %}
{% if device.pdu_type == 'rpdu' %}
var chekbox_{{device.pdu_port}} = document.getElementById('chk-{{device.pdu_port}}-right');
if(chekbox_{{device.pdu_port}} !== null && chekbox_{{device.pdu_port}} !== 'undefined' ) {
chekbox_{{device.pdu_port}}.checked=true;
chekbox_{{device.pdu_port}}.title="PDU Device: {{device.pdudevice}}\nPDU Type: {{device.pdu_type|upper}}\nPDU Port: {{device.pdu_port}}\nDevice: {{device.device}}\nDevice Port: {{device.device_port}}";
}
{% elif device.pdu_type == 'lpdu' %}
var chekbox_{{device.pdu_port}} = document.getElementById('chk-{{device.pdu_port}}-left');
if(chekbox_{{device.pdu_port}} !== null && chekbox_{{device.pdu_port}} !== 'undefined' ) {
chekbox_{{device.pdu_port}}.checked=true;
chekbox_{{device.pdu_port}}.title="PDU Device: {{device.pdudevice}}\nPDU Type: {{device.pdu_type|upper}}\nPDU Port: {{device.pdu_port}}\nDevice: {{device.device}}\nDevice Port: {{device.device_port}}";
}
{% else %}
{% endif %}
var device_{{device.device.id}} = document.getElementById('device-{{device.device.id}}-right');
if(device_{{device.device.id}} !== null && device_{{device.device.id}} !== 'undefined' ) {
device_{{device.device.id}}.style.background = "#1a711b";
}
var device_{{device.device.id}} = document.getElementById('device-{{device.device.id}}-left');
if(device_{{device.device.id}} !== null && device_{{device.device.id}} !== 'undefined' ) {
device_{{device.device.id}}.style.background = "#1a711b";
}
{% endfor %}
{% for d in alphabets %}
var alpha_front_{{d}} = document.getElementById('td-{{d}}');
if(alpha_front_{{d}} !== null && alpha_front_{{d}} !== 'undefined' ) {
  alpha_front_{{d}}.innerHTML = "{{ alphabets|dict_key:d }}";
}
{% endfor %}

{% for d in alphabets %}
var alpha_rear_{{d}} = document.getElementById('alpha-rear-{{d}}');
if(alpha_rear_{{d}} !== null && alpha_rear_{{d}} !== 'undefined' ) {
  alpha_rear_{{d}}.innerHTML = "{{ alphabets|dict_key:d }}";
}
{% endfor %}
{% if expand %}
collapase = $("#collapse4");
collapase.addClass("in");
{% endif %}
</script>
<script>
function handleDel(deviceId, returnID,height,loc,rackid){

    Swal.fire({
        title: 'Are you sure you want to delete this item?',
        showCancelButton: true,
        confirmButtonText: 'Delete',
        }).then((result) => {
        if (result.isConfirmed) {
            window.location = "/asset/datacenter/information/hall/device/delete/"+deviceId+"/?return="+returnID+"&height="+height+"&loc="+loc+"&rackid="+rackid;
        }
        }) 
}
</script>
{% endblock js %}