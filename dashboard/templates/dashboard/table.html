{% extends 'dashboard/header_footer.html' %}{% load static %} {% block title %} Network {% endblock title %}{% block title_header %}MyDashboard{% endblock %} {% block css %}
<style>

:root {
    --primary-color: #9A97F3;
    --secondary-color: #818cab;
    --font-color: black;
    --bg-color: #fff;
    --heading-color: #818cab;
    --tablebg:#00ff89;
    --tblshadow: 0px -21px 23px #fbfbfb inset;
}
[data-theme="dark"] {
    --primary-color: #9A97F3;
    --secondary-color: #818cab;
    --font-color: white;
    --bg-color: #1b1a1a;
    --heading-color: #818cab;
    --tablebg:#535353;
    --tblshadow: 0px -21px 23px #1b1818 inset;
}
    .card-counter {
        box-shadow: 2px 2px 10px #DADADA;
        margin: -13px;
        padding: 20px 10px;
        background-color: #fff;
        height: 70px;
        border-radius: 5px;
        transition: .3s linear all;
    }
    
    .card-counter:hover {
        box-shadow: 4px 4px 20px #DADADA;
        transition: .3s linear all;
    }
    
    .card-counter.primary {
        background-color: #007bff;
        color: #FFF;
    }
    
    .card-counter.danger {
        background-color: #ef5350;
        color: #FFF;
    }
    
    .card-counter.success {
        background-color: #66bb6a;
        color: #FFF;
    }
    
    .card-counter.info {
        background-color: #26c6da;
        color: #FFF;
    }
    
    .card-counter i {
        font-size: 5em;
        opacity: 0.2;
    }
    
    .card-counter .count-numbers {
        position: relative;
        text-align: center;
        right: 2px;
        top: -25px;
        font-size: 32px;
        display: block;
    }
    
    .card-counter .count-name {
        position: relative;
        top: -25px;
        text-transform: capitalize;
        opacity: 0.5;
        display: block;
        font-size: 18px;
        text-align: center;
    }
    
    fieldset.scheduler-border {
        /* border: 1px groove #ddd !important; */
        padding: 0 1.4em 1.4em 1.4em !important;
        /* margin: 0 0 1.5em 0 !important; */
        -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .15), 0 2px 2px rgba(0, 0, 0, .15), 0 4px 4px rgba(0, 0, 0, .15), 0 8px 8px rgba(0, 0, 0, .15);
        box-shadow: 0 1px 1px rgba(0, 0, 0, .15), 0 2px 2px rgba(0, 0, 0, .15), 0 4px 4px rgba(0, 0, 0, .15), 0 8px 8px rgba(0, 0, 0, .15);
    }
    
    legend.scheduler-border {
        font-size: 1em !important;
        font-weight: bold !important;
        text-align: left !important;
        width: auto;
        padding: 0 10px;
        border-bottom: none;
    }
    
    .col-md-offset-1 {
        margin-left: 2.333%;
    }
    
    .container {
        width: 100%;
    }
    
    .headerCol {
        width: 14.667%;
    }
    
    .card {
        background: transparent;
        color: black;
        box-shadow: 0 0 1px #232323;
        text-align: left;
        margin-bottom: 12px;
    }
    
    .chartbtn {
        position: relative;
        background: none;
        border: none;
        font-size: 11px;
        right: 0;
        padding-right: 10px;
        padding-left: 10px;
    }
    
    .chartBtnSelection {
        color: green;
        font-weight: bolder;
    }
    
    .indSmry {
        background: blue;
        padding-right: 0px;
        padding-left: 0px;
    }
    
    .divIndSmry {
        background: transparent;
        position: aboslute;
        top: 50%;
        text-align: left;
        font-size: 12px;
        font-weight: bold;
    }
    #container{
        background: black;
        color: white;
    }
    table, tbody, tr, th, td{
    background: rgba(0, 0, 0, 0.0) !important;
    border-top: none !important;
    border-bottom: none !important;
}
.mytable, tbody, tr, th, td{
    padding: 10px;
}
.infodiv{
    color: var(--font-color);
    background: var(--tablebg);
    box-shadow: var(--tblshadow);
}
.infodiv:hover{
    background: #004fff;
    color: #ffffff;
    cursor: pointer;
}
.darktext{
    color: var(--font-color);
    margin-left:10px;
}
.interfaceDetails{
    background: whitesmoke;
    height:70px;
    /*box-shadow: -4px 52px 59px #888888 inset;*/
    box-shadow: 11px -35px 55px #89df2a8a inset;
}
.interfaceheader{
    font-size: 10px;text-align: left;
    font-weight: bold;
    margin-top: 5px;
}


/* Toogle Btn*/
/*Simple css to style it like a toggle switch*/
.theme-switch-wrapper {
  display: flex;
  align-items: center;

  em {
    margin-left: 10px;
    font-size: 1rem;
  }
}
.theme-switch {
  display: inline-block;
  height: 34px;
  position: relative;
  width: 60px;
}

.theme-switch input {
  display:none;
}

.slider {
  background-color: #ccc;
  bottom: 0;
  cursor: pointer;
  left: 0;
  position: absolute;
  right: 0;
  top: 0;
  transition: .4s;
}

.slider:before {
  background-color: #fff;
  bottom: 4px;
  content: "";
  height: 26px;
  left: 4px;
  position: absolute;
  transition: .4s;
  width: 26px;
}

input:checked + .slider {
  background-color: #66bb6a;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}



/* Night Theme*/
.inner-block{
    background: var(--bg-color);
}
.right-content{
    background: var(--bg-color);
}


</style>

{% endblock %}{% block js %}
<script src="{% static '/dashboard/js/plotly.js' %}"></script>
<script src="{% static '/dashboard/js/Chart.min.js' %}"></script>
<script type="text/javascript" src="{% static '/dashboard/js/echarts.min.js' %}"></script>
<script type="text/javascript" src="{% static '/dashboard/js/echarts-liquidfill.min.js' %}"></script>
<script src="{% static '/graphs/bargraph.js' %}"></script>
<script type="text/javascript" charset="utf8" src="{% static 'dashboard/js/datatable.js' %}"></script>
{{data|json_script:"data"}}
<script>
const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');

function switchTheme(e) {
    if (e.target.checked) {
        document.documentElement.setAttribute('data-theme', 'dark');
    }
    else {
        document.documentElement.setAttribute('data-theme', 'light');
    }    
}

toggleSwitch.addEventListener('change', switchTheme, false);
//ADD TRAILING 0 TO SINGLE DIGIT IN UPTIME
    function AddZero(n) {
        return (n < 10 ? '0' : '') + n;
    }
    // FUNCTION FOR SYSTEM UPTIME
    function uptimeTOdays(sec) {
        seconds = Number(sec);
        var d = Math.floor(seconds / (3600 * 24));
        var h = Math.floor(seconds % (3600 * 24) / 3600);
        var m = Math.floor(seconds % 3600 / 60);
        var s = Math.floor(seconds % 60);

        var dDisplay = d > 0 ? d + (d == 1 ? "D " : "D ") : "";
        var hDisplay = h > 0 ? h + (h == 1 ? "  " : " : ") : "";
        var mDisplay = m > 0 ? m + (m == 1 ? " : " : " : ") : "";
        var sDisplay = s > 0 ? s + (s == 1 ? "" : "") : "";
        return (dDisplay + hDisplay + mDisplay + sDisplay).replace(/,\s*$/, "");
    }
    // bit to kb
    function bitToKB(bit) {
        return (bit / 1048576);
    }
    var FIRST_RUN = 0;

function Statistics(host, tempip) {
    
    console.log("RUNNING UPDATE_FUNCTION", host, tempip);
        $.ajax({
            type: 'GET',
            url: "/summary/server/individual/?host=" + host,
            success: function(response) {
                console.log("PRINTING DASHBOARD OF ", host, response);
                    DATA = response["data"]
                    //SYSINFO = JSON.parse(response["data"]["sysinfo"]);
                    //ASSETDEVICEINFP = JSON.parse(response["data"]["assetDevice"]);
                    var html = "";
                    ASSETS = DATA["assets"]
                    //for (var i in ASSETDEVICEINFP) {
                        html += "<tr><th>IP</th><td>" + host + "</td><tr>";
                        html += "<tr><th>ASSET TAG</th><td>" + ASSETS["Device_Asset_Tag"] + "</td><tr>";
                    //}
                    
                    
                    //for (var i in SYSINFO) {
                        html += "<tr><th>NAME</th><td>" + DATA["name"] + "</td><tr>";
                        //html += "<tr><th>STATUS</th><td>" + SYSINFO[i]["fields"]["is_active"] + "</td><tr>";
                        html += "<tr><th>DESCRIPTION</th><td>" + DATA["description"] + "</td><tr>";
                        //html += "<tr><th>TEMPERATURE</th><td>"+"0<sup>o</sup>C"+"</td><tr>";
                        //html += "<tr><th>LOCATION</th><td>" + SYSINFO[i]["fields"]["location"] + "</td><tr>";
                        //html += "<tr><th>CONTACT</th><td>" + SYSINFO[i]["fields"]["contact"] + "</td><tr>";
                        $("#"+tempip+"sysUptime").html(DATA["uptime"]);
                        //break;
                    //}
                    
                    $("#"+tempip+"sysinfoTable tbody").html(html);
                    //console.log("interfaces____________________________")

                    interfaces = [];
                    try {
                        interfaces = DATA["interfaces"];
                    } catch (ex) {
                        interfaces = [];
                    }

                    var totalInterface = interfaces.length;
                    var adminUp = 0;
                    var adminDown = 0;
                    var adminUnknown = 0;
                    var portUp = 0;
                    var portDown = 0;
                    var portUnknown = 0;
                    var pktIn = 0;
                    var pktOut = 0;

                    if (interfaces != undefined) {
                        var html = "";
                        for (var i in interfaces) {
                            if (interfaces[i]["adminstatus"] == "up") {
                                adminUp += 1;
                                interfaces[i]["adminstatus"] = "<i class='fa fa-circle text-success'></i>";
                            } else if (interfaces[i]["adminstatus"] == "down") {
                                adminDown += 1
                                interfaces[i]["adminstatus"] = "<i class='fa fa-circle text-danger'></i>"
                            } else {
                                adminUnknown += 1
                                interfaces[i]["adminstatus"] = "<i class='fa fa-circle text-muted'></i>"
                            }
                            if (interfaces[i]["operstatus"] == "up") {
                                portUp += 1;
                                interfaces[i]["operstatus"] = "<i class='fa fa-circle text-success'>"
                            } else if (interfaces[i]["operstatus"] == "down") {
                                portDown += 1
                                interfaces[i]["operstatus"] = "<i class='fa fa-circle text-danger'>"
                            } else {
                                portUnknown += 1
                                interfaces[i]["operstatus"] = "<i class='fa fa-circle text-muted'>"
                            }
                            pktIn += interfaces[i]["inOctect"];
                            pktOut += interfaces[i]["outOctect"];
                        }
                    }

                    $("#"+tempip+"totalInterface").html(totalInterface);
                    $("#"+tempip+"totaladminUP").html("<i class='fa fa-arrow-up text-success'></i> " + adminUp + " <i class='fa fa-arrow-down text-muted'></i> " + adminDown + " <i class='fa fa-ban text-danger'></i> " + adminUnknown);
                    $("#"+tempip+"totalPortUp").html("<i class='fa fa-arrow-up text-success'></i> " + portUp + " <i class='fa fa-arrow-down text-muted'></i> " + portDown + " <i class='fa fa-ban text-danger'></i> " + portUnknown);
                    $("#"+tempip+"pktIn").html(pktIn.toFixed(2));
                    $("#"+tempip+"pktOut").html(pktOut.toFixed(2));
                
                //AllEvents(response["cpuPercentage"], response["usedRam"], response["availRam"], response["totalRam"], response["usedStorage"], response["freeStorage"], response["totalStorage"],response["iowat"],response["availSMemory"],response["usedSMemory"],response["runningProcess"]);
            },
            error: function(xhr, status, error) {
                console.log(status, error);
                var err = eval("(" + xhr.responseText + ")");
                Swal.fire(err.Message);
            }
        });
    };


const UPDATE_FUNCTION = JSON.parse(document.getElementById('data').textContent);

    $(document).on('click','.table', function() {
        var host = $(this).data('url');
        var str = $(this).data('str');
        window.open('/dashboard/host/'+host+'/'+str, '_blank');
    });
</script>


<script>
function iptostr(str){
    return str.split('.').join('_');
}



//var TOTAL_NUM_OF_DEVICES = Object.keys(UPDATE_FUNCTION).length;
for (var i in UPDATE_FUNCTION){
    var HTML = "";
    var url = UPDATE_FUNCTION[i]["url"];
    var string = UPDATE_FUNCTION[i]["string"];
    var interval = iptostr(url);
    clearInterval(interval);
    HTML += "<div class='col-md-6' style='margin-bottom:18px'>\
        <div class='card col-lg-12 infodiv'>\
            <table data-url='"+url+"' data-str='"+string+"' class='table' id='"+iptostr(url)+"sysinfoTable'>\
                <tbody></tbody>\
            </table>\
            <i data-url='"+url+"' class='fa fa-close removefvrt' style='position: absolute;top: 4px;left: 96%;font-size:20px'></i>\
        </div>\
        <div class='card col-lg-12 indSmry'>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>UPTIME</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"sysUptime'></p>\
            </div>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>Interfaces</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"totalInterface'></p>\
            </div>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>Admin</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"totaladminUP'></p>\
            </div>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>Port</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"totalPortUp'></p>\
            </div>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>Pkt IN</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"pktIn'></p>\
            </div>\
            <div class='col-md-2 interfaceDetails'>\
                <p class='interfaceheader'>Pkt Out</p>\
                <div style='position:absolute; right: 20px;'></div>\
                <p class='divIndSmry' id='"+iptostr(url)+"pktOut'></p>\
            </div>\
        </div>\
        </div>";
        //console.log("TIMES: ", url, iptostr(url))
        Statistics(url, iptostr(url));
        //interval = setInterval(function() {Statistics(url, iptostr(url));}, 2000);
$("#container").append(HTML);
}
$("#container").css("display", "block");

$(document).on('click','.removefvrt', function(){
    var url = $(this).data('url');
    var me = $(this).parent().parent();
    
    Swal.fire({
        title: 'Are you sure want to remove from favourite?',
        showCancelButton: true,
        confirmButtonText: 'Remove',
        }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
        type: 'POST',
        url: "/makedevicefav/",
        data: {
            "host":url,
        },
        success: function(response) {
            Swal.fire(response["data"]);
            me.hide();
        },
        error: function(xhr, status, error) {
            console.log(status, error);
            var err = eval("(" + xhr.responseText + ")");
            Swal.fire(err.Message);
        }
    });
        }
        }) 
    
})
</script>
{% endblock js %}

{% block content %}

<!--<select id="allNetworkDevices">
<option disabled="disabled" selected="selected">--View Device--</option>
{% for data in device %}
<option value="{{data.ip}}">{{data.name}}</option>
{% endfor %}
</select>-->
<div class="theme-switch-wrapper container">
    <label class="theme-switch" for="checkbox">
        <input type="checkbox" id="checkbox" />
        <div class="slider round"></div>
  </label>
  <em class="darktext">Dark Mode</em>
</div>
<br>
<div id='container' style='display:none'></div>
{% endblock content %}